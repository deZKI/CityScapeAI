import {useEffect} from 'react';
import {useMap} from 'react-leaflet';
import * as L from 'leaflet';
import 'leaflet.heat';

export default function HeatmapLayer() {
  const map = useMap();

  useEffect(() => {
    if (!map) return;

    const generateHeatmapData = (coordinates: [number, number][]) => {
      return coordinates.map(coord => [
        coord[1], // широта
        coord[0], // долгота
        Math.floor(Math.random() * 10) + 1 // случайная интенсивность от 1 до 10
      ]);
    };

    const coordinates: [number, number][] = [
      [36.8818703, 55.4426547],
      [36.8875942, 55.4460139],
      [37.006115, 55.3828488],
      [37.0056529, 55.3837762],
      [37.007919, 55.3854262],
      [37.0094042, 55.3857282],
      [37.0124558, 55.3898936],
      [37.0128457, 55.3915256],
      [37.011816, 55.3922038],
      [37.0113221, 55.3923045],
      [37.0103152, 55.3918918],
      [37.009309, 55.3933941],
      [37.0097069, 55.3941968],
      [37.0089596, 55.3944778],
      [37.0081666, 55.3944003],
      [37.0097748, 55.3968071],
      [37.0123461, 55.3978948],
      [37.0155599, 55.3990103],
      [37.0185142, 55.3993982],
      [37.0206857, 55.3990728],
      [37.023938, 55.4007514],
      [37.0261902, 55.4018559],
      [37.0271445, 55.4022984],
      [37.027816, 55.4018349],
      [37.0328864, 55.4021395],
      [37.0362804, 55.4025571],
      [37.0364945, 55.4015049],
      [37.0409097, 55.3998827],
      [37.0431881, 55.398978],
      [37.0443085, 55.3988566],
      [37.0457676, 55.3994664],
      [37.0471917, 55.39936],
      [37.052566, 55.4000004],
      [37.0545078, 55.3988569],
      [37.0590221, 55.398828],
      [37.0612687, 55.3985093],
      [37.0643173, 55.3989709],
      [37.0707069, 55.4032983],
      [37.0728374, 55.4046237],
      [37.0728316, 55.4047893],
      [37.0760998, 55.4069594],
      [37.0750927, 55.4084566],
      [37.0739049, 55.4117954],
      [37.0738059, 55.4124832],
      [37.0741563, 55.4127144],
      [37.0750219, 55.4134904],
      [37.0744529, 55.4144538],
      [37.0737271, 55.4150766],
      [37.0733003, 55.4156645],
      [37.0728405, 55.4167908],
      [37.0726793, 55.418086],
      [37.0729753, 55.4185128],
      [37.0731251, 55.4190574],
      [37.0731808, 55.4203435],
      [37.0739793, 55.421673],
      [37.0749121, 55.4226537],
      [37.0753455, 55.4231092],
      [37.0767752, 55.4248845],
      [37.0770421, 55.4253725],
      [37.0772402, 55.4259216],
      [37.0812197, 55.4256745],
      [37.0821399, 55.4252349],
      [37.0828725, 55.4249238],
      [37.0836234, 55.425393],
      [37.0860517, 55.4259882],
      [37.0881557, 55.4281793],
      [37.0904298, 55.4303108],
      [37.0942715, 55.4316032],
      [37.0967928, 55.4314764],
      [37.0979855, 55.4324289],
      [37.0994076, 55.4327432],
      [37.1002463, 55.4335837],
      [37.1001939, 55.4347711],
      [37.0993897, 55.4356623],
      [37.0997182, 55.4371125],
      [37.1040281, 55.4381534],
      [37.1054202, 55.4381981],
      [37.1065015, 55.4385182],
      [37.1084991, 55.4395122],
      [37.1093022, 55.4398636],
      [37.11055, 55.44041],
      [37.1123766, 55.4412122],
      [37.1125655, 55.4412924],
      [37.1113021, 55.4426233],
      [37.1107861, 55.4431651],
      [37.1079402, 55.4450667],
      [37.1105305, 55.4470498],
      [37.1128382, 55.4480887],
      [37.1131066, 55.4482097],
      [37.1127784, 55.4492266],
      [37.1120061, 55.4489079],
      [37.1107738, 55.4483991],
      [37.1093179, 55.448059],
      [37.1065, 55.4473077],
      [37.1048456, 55.44691],
      [37.1026178, 55.4463941],
      [37.100804, 55.4459789],
      [37.1000317, 55.4457673],
      [37.0998116, 55.4457102],
      [37.0998691, 55.4456751],
      [37.100764, 55.4451234],
      [37.0970779, 55.4426935],
      [37.0960453, 55.4432768],
      [37.0949555, 55.4427189],
      [37.0939454, 55.4423902],
      [37.0929157, 55.4420672],
      [37.090679, 55.4415476],
      [37.0892834, 55.4412316],
      [37.089198, 55.4413959],
      [37.0891407, 55.441512],
      [37.0885776, 55.4425529],
      [37.0872679, 55.4462724],
      [37.0843169, 55.4457367],
      [37.0825219, 55.4454923],
      [37.0806183, 55.4466848],
      [37.0814225, 55.4482436],
      [37.079767, 55.4489352],
      [37.0786002, 55.4500415],
      [37.0805144, 55.4507438],
      [37.0803245, 55.4526986],
      [37.0767899, 55.4535678],
      [37.0743798, 55.4536543],
      [37.0726524, 55.453679],
      [37.0718057, 55.4537522],
      [37.0586117, 55.4546905],
      [37.0606131, 55.4626603],
      [37.0444784, 55.4636633],
      [37.0368186, 55.464061],
      [37.0355766, 55.4584408],
      [37.035206, 55.4583195],
      [37.0321283, 55.4559566],
      [37.0200709, 55.4567858],
      [37.0192337, 55.4451288],
      [37.0062621, 55.4461459],
      [37.0045892, 55.4471489],
      [37.0033405, 55.4494999],
      [37.0055731, 55.4505198],
      [37.002084, 55.4525958],
      [36.9996863, 55.4526079],
      [36.9988214, 55.4536278],
      [36.9980562, 55.4537817],
      [36.9972791, 55.4549095],
      [36.9975984, 55.4552006],
      [36.9962463, 55.4564356],
      [36.9943467, 55.4560351],
      [36.9933152, 55.4566522],
      [36.9940174, 55.4583184],
      [36.9895955, 55.459224],
      [36.9892874, 55.4568512],
      [36.9868846, 55.4573014],
      [36.9839601, 55.457693],
      [36.9829592, 55.454873],
      [36.9734462, 55.4554605],
      [36.9748424, 55.4670793],
      [36.9757199, 55.4760051],
      [36.9767632, 55.4850302],
      [36.9776511, 55.4937723],
      [36.9620549, 55.4946698],
      [36.9542509, 55.4950999],
      [36.9350578, 55.4961553],
      [36.9374458, 55.4985564],
      [36.9380657, 55.4990019],
      [36.9370871, 55.4994194],
      [36.9369095, 55.4994809],
      [36.9352278, 55.505233],
      [36.9379678, 55.5070078],
      [36.9371283, 55.5082756],
      [36.9377862, 55.5094618],
      [36.9360189, 55.5090215],
      [36.9367498, 55.5100033],
      [36.9373607, 55.5108699],
      [36.9379371, 55.5116581],
      [36.9382123, 55.5120227],
      [36.939271, 55.5131477],
      [36.93967, 55.5134773],
      [36.9387646, 55.5138632],
      [36.9385351, 55.5139797],
      [36.9382418, 55.5141285],
      [36.9381457, 55.5142215],
      [36.9376052, 55.514483],
      [36.9374106, 55.5145682],
      [36.9359909, 55.5149929],
      [36.9197539, 55.5154461],
      [36.9194745, 55.5058449],
      [36.8991433, 55.5061324],
      [36.8826175, 55.5063277],
      [36.8694399, 55.506501],
      [36.8616213, 55.5066614],
      [36.8565016, 55.5068778],
      [36.8445171, 55.5070693],
      [36.8278753, 55.507513],
      [36.8279763, 55.5084235],
      [36.8160527, 55.5083589],
      [36.816023, 55.5048728],
      [36.8160689, 55.4952994],
      [36.8159244, 55.484263],
      [36.815749, 55.4751564],
      [36.8152077, 55.4659722],

      [37.0103878, 55.1833315],
      [37.014624, 55.1837627],
      [37.0157295, 55.183994],
      [37.0164739, 55.184019],
      [37.0172292, 55.1838315],
      [37.0197139, 55.1829503],
      [37.0193856, 55.182519],
      [37.0163644, 55.1798377],
      [37.0151384, 55.1783251],
      [37.014613, 55.1776688],
      [37.0142189, 55.1773],
      [37.0146568, 55.1765937],
      [37.0159047, 55.1765187],
      [37.0180939, 55.1772688],
      [37.0182362, 55.1742308],
      [37.0192618, 55.1729636],
      [37.0194652, 55.1714944],
      [37.0192303, 55.1689537],
      [37.0198202, 55.167195],
      [37.0198904, 55.1611199],
      [37.0185474, 55.1601772],
      [37.0152269, 55.1599986],
      [37.0181058, 55.1575885],
      [37.0208478, 55.1560649],
      [37.0232266, 55.1555999],
      [37.0274341, 55.1526132],
      [37.0279371, 55.1501468],
      [37.0309138, 55.148647],
      [37.0322169, 55.1481244],
      [37.0325737, 55.147703],
      [37.0378396, 55.1460157],
      [37.0392054, 55.1425215],
      [37.041524, 55.1428498],
      [37.0441018, 55.1423397],
      [37.0456319, 55.1421745],
      [37.0448159, 55.143376],
      [37.064748, 55.1442772],
      [37.0643935, 55.147119],
      [37.1112104, 55.149187],
      [37.1105834, 55.1541636],
      [37.1413365, 55.1556654],
      [37.1420798, 55.1556758],
      [37.1408347, 55.1626317],
      [37.1407765, 55.1643778],
      [37.1563181, 55.1647621],
      [37.1571762, 55.1617451]
    ];

    const GeoData = generateHeatmapData(coordinates);

    const heatmapLayer = (L as any).heatLayer(GeoData, {
      radius: 20,
      maxOpacity: 0.8,
      scaleRadius: true,
    });

    heatmapLayer.addTo(map);

    return () => {
      map.removeLayer(heatmapLayer);
    };
  }, [map]);

  return null;
};